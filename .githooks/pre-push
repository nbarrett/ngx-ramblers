#!/usr/bin/env bash

set -e

ROOT_DIR="$(cd "$(dirname "$0")/.." && pwd)"

source "${ROOT_DIR}/node_modules/@annix/claude-swarm/timer.sh"

echo "Running pre-push checks..."

run_lint() {
  cd "$ROOT_DIR"
  npm run lint:all
}

run_frontend_tests() {
  cd "$ROOT_DIR"
  npm run test
}

run_server_tests() {
  cd "$ROOT_DIR"
  npm run test:server
}

cd "$ROOT_DIR"
timed_step "lint" run_lint
timed_step "frontend tests" run_frontend_tests
timed_step "server tests" run_server_tests

print_timing_summary

echo "Pre-push checks passed!"
